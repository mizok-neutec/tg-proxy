<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Telegram Bot Proxy API</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        line-height: 1.6;
        color: #333;
      }
      .header {
        text-align: center;
        margin-bottom: 3rem;
      }
      .api-endpoint {
        background: #f5f5f5;
        padding: 1rem;
        border-radius: 8px;
        font-family: "Monaco", monospace;
        margin: 1rem 0;
      }
      .example {
        background: #e3f2fd;
        padding: 1.5rem;
        border-radius: 8px;
        margin: 1rem 0;
      }
      .button {
        display: inline-block;
        background: #007bff;
        color: white;
        padding: 0.75rem 1.5rem;
        text-decoration: none;
        border-radius: 5px;
        margin: 0.5rem 0;
      }
      .button:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ğŸ¤– Telegram Bot Proxy API</h1>
      <p>ä½¿ç”¨ Netlify Serverless Function ç™¼é€ Telegram è¨Šæ¯</p>
    </div>

    <h2>API ç«¯é»</h2>
    <div class="api-endpoint">POST /api/send-message</div>

    <h2>ä½¿ç”¨æ–¹å¼</h2>
    <div class="example">
      <h3>è«‹æ±‚ç¯„ä¾‹ï¼š</h3>
      <pre><code>{
  "botToken": "your-bot-token",
  "chatId": "chat-id-or-username", 
  "message": "Hello from API! ğŸš€",
  "parseMode": "HTML"
}</code></pre>
    </div>

    <h2>å¿«é€Ÿæ¸¬è©¦</h2>
    <div class="example">
      <p>ä½¿ç”¨ä»¥ä¸‹ curl å‘½ä»¤æ¸¬è©¦ APIï¼š</p>
      <pre><code>curl -X POST https://yourdomain.netlify.app/api/send-message \
  -H "Content-Type: application/json" \
  -d '{
    "botToken": "YOUR_BOT_TOKEN",
    "chatId": "YOUR_CHAT_ID",
    "message": "æ¸¬è©¦è¨Šæ¯"
  }'</code></pre>
    </div>

    <h2>æ–‡ä»¶</h2>
    <a href="https://github.com/cpsc2fe/tg-proxy" class="button"
      >æŸ¥çœ‹ GitHub å„²å­˜åº«</a
    >

    <script>
      // ç°¡å–®çš„æ¸¬è©¦ä»‹é¢
      function createTestForm() {
        const container = document.createElement("div");
        container.innerHTML = `
                <h2>ç·šä¸Šæ¸¬è©¦</h2>
                <div class="example">
                    <form id="testForm">
                        <p>
                            <label>Bot Token:</label><br>
                            <input type="text" id="botToken" style="width: 100%; padding: 0.5rem; margin: 0.25rem 0;" placeholder="1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefgh">
                        </p>
                        <p>
                            <label>Chat ID:</label><br>
                            <input type="text" id="chatId" style="width: 100%; padding: 0.5rem; margin: 0.25rem 0;" placeholder="123456789 æˆ– @username">
                        </p>
                        <p>
                            <label>è¨Šæ¯:</label><br>
                            <textarea id="message" style="width: 100%; padding: 0.5rem; margin: 0.25rem 0; height: 80px;" placeholder="è¦ç™¼é€çš„è¨Šæ¯..."></textarea>
                        </p>
                        <button type="submit" class="button">ç™¼é€æ¸¬è©¦è¨Šæ¯</button>
                    </form>
                    <div id="result" style="margin-top: 1rem;"></div>
                </div>
            `;

        document.body.appendChild(container);

        document
          .getElementById("testForm")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            const botToken = document.getElementById("botToken").value;
            const chatId = document.getElementById("chatId").value;
            const message = document.getElementById("message").value;
            const resultDiv = document.getElementById("result");

            if (!botToken || !chatId || !message) {
              resultDiv.innerHTML =
                '<p style="color: red;">è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½</p>';
              return;
            }

            resultDiv.innerHTML = "<p>ç™¼é€ä¸­...</p>";

            try {
              const response = await fetch("/api/send-message", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  botToken,
                  chatId,
                  message,
                }),
              });

              const result = await response.json();

              if (result.success) {
                resultDiv.innerHTML = `<p style="color: green;">âœ… è¨Šæ¯ç™¼é€æˆåŠŸï¼<br>è¨Šæ¯ ID: ${result.messageId}</p>`;
              } else {
                resultDiv.innerHTML = `<p style="color: red;">âŒ ç™¼é€å¤±æ•—: ${result.error}</p>`;
              }
            } catch (error) {
              resultDiv.innerHTML = `<p style="color: red;">âŒ è«‹æ±‚éŒ¯èª¤: ${error.message}</p>`;
            }
          });
      }

      // è¼‰å…¥æ¸¬è©¦è¡¨å–®
      createTestForm();
    </script>
  </body>
</html>
